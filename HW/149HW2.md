<h1>Code Smell: Message Chains</h1>
Message Chains คือรูปแบบโค้ดที่มีการเรียกต่อกันเป็นทอด ๆ ผ่านหลายอ็อบเจ็กต์ เช่น

```
order.getCustomer().getAddress().getCity().getZipCode();
```

ลักษณะนี้ถูกมองว่าเป็น code smell เพราะมันทำให้โค้ดผูกติดกับโครงสร้างภายในของอ็อบเจ็กต์หลายชั้นมากเกินไป และแสดงให้เห็นว่าอ็อบเจ็กต์หนึ่ง “รู้เรื่อง” ของอีกอ็อบเจ็กต์ลึกเกินความจำเป็น
ตามแนวคิด Refactoring โค้ดที่ดีควรสื่อสารกับ “เพื่อนบ้านโดยตรง” ของมันเท่านั้น (แนวคิดคล้าย Law of Demeter) ไม่ควรไล่เข้าถึงข้อมูลภายในของวัตถุอื่นหลายชั้น
ทำไม Message Chains ถึงเป็น Code Smell

1. เพิ่มความเปราะบางของโค้ด (Fragile Code)
ถ้าโครงสร้างภายในของคลาสใดคลาสหนึ่งเปลี่ยน เช่น Address ไม่มี getCity() แล้ว โค้ดทุกจุดที่เรียกต่อกันเป็นสายจะพังทันที

2. ทำให้เกิด Coupling สูง
คลาสที่เรียก chain ต้องรู้รายละเอียดโครงสร้างของหลายคลาส ทำให้พึ่งพากันแน่นเกินไป แก้ไขยาก ขยายยาก

3. อ่านยาก และเข้าใจ flow ยาก
การไล่ดูว่าข้อมูลมาจากไหนต้องไล่ตามหลายคลาส ทำให้โค้ดไม่กระชับ และทำให้ business logic กระจาย

4. ซ่อนปัญหาการออกแบบความรับผิดชอบ (Responsibility)
แทนที่จะให้อ็อบเจ็กต์จัดการข้อมูลของตัวเอง กลับดึงข้อมูลลึก ๆ ออกมาใช้ภายนอก แสดงว่าการกระจายหน้าที่อาจไม่เหมาะสม

ตัวอย่างโค้ดที่เกิด Code Smell: Message Chains (C#)
---

ตัวอย่างโค้ดที่มีการเรียกเมธอดต่อกันหลายชั้น จนโค้ดผูกกับโครงสร้างภายในของหลายคลาส
```
using System;

class Program
{
    static void Main()
    {
        Order order = new Order();
        Console.WriteLine(order.GetCustomer().GetAddress().GetCity().GetZipCode());
    }
}

class Order
{
    public Customer GetCustomer() => new Customer();
}

class Customer
{
    public Address GetAddress() => new Address();
}

class Address
{
    public City GetCity() => new City();
}

class City
{
    public string GetZipCode() => "10110";
}
```
จุดที่เป็น Message Chains smell ในตัวอย่างนี้
---
- order.GetCustomer().GetAddress().GetCity().GetZipCode() เรียกข้อมูลลึก 4 ชั้น

- Program ต้องรู้โครงสร้างภายในของ Order → Customer → Address → City

- ถ้ามีการเปลี่ยนโครงสร้าง เช่น Address ไม่มี City แล้ว โค้ดภายนอกพังทันที

- แสดงว่า Responsibility กระจายไม่เหมาะสม และ Coupling สูงมาก

- โค้ดอ่านยาก เพราะต้องไล่ดูหลายคลาสว่าแต่ละชั้นคืนค่าอะไร

ตัวอย่างโค้ดที่ Refactor แล้ว (ลด Message Chains)
---
แนวคิด refactor: ให้ Object จัดการข้อมูลของตัวเอง และ ซ่อน delegate
```
using System;

class Program
{
    static void Main()
    {
        Order order = new Order();
        Console.WriteLine(order.GetShippingZipCode());
    }
}

class Order
{
    private Customer customer = new Customer();

    public string GetShippingZipCode()
    {
        return customer.GetShippingZipCode();
    }
}

class Customer
{
    private Address address = new Address();

    public string GetShippingZipCode()
    {
        return address.GetZipCode();
    }
}

class Address
{
    public string GetZipCode() => "10110";
}
```
แนวคิด Refactor ที่ใช้
---
- Hide Delegate → ไม่ให้คลาสภายนอกรู้โครงสร้างลึก ๆ

- Move Method → ย้ายพฤติกรรมไปยังคลาสที่ควรรับผิดชอบ

- ลดการเรียก .GetX().GetY().GetZ() ต่อกันยาว ๆ

ผลลัพธ์หลัง Refactor
---
- ลด Coupling ระหว่างคลาส

- โค้ดภายนอกไม่พังเมื่อโครงสร้างภายในเปลี่ยน

- อ่านง่ายขึ้น เพราะไม่ต้องไล่หลายชั้น

- ระบบยืดหยุ่นและดูแลง่ายขึ้น

กรณีที่ Message Chains ไม่ได้แปลว่าผิดเสมอ
---
บางกรณีใช้ได้ เช่น:
- ใช้กับ DTO / Data Structure ที่มีหน้าที่เก็บข้อมูลเฉย ๆ
- Query object เช่น LINQ, Fluent API ที่ออกแบบมาเพื่อ chaining โดยเฉพาะ
- Object ที่ตั้งใจเปิดโครงสร้างข้อมูล (ไม่มี logic)

แหล่งอ้างอิง (References)
---

<ol>
  
<li> Refactoring Guru : “Code Smells: Message Chains” และแนวทาง refactoring (Hide Delegate, Extract/Move Method) </li>
  <ul>
   Link : https://refactoring.guru/smells/message-chains
  </ul>
<li> SourceMaking : “Message Chains” smell — อธิบายสาเหตุของ Message Chains และวิธีลด coupling ด้วย refactoring  </li>
  <ul>
    Link : https://sourcemaking.com/refactoring/smells/message-chains
  </ul>
<li> Tushar Sharma – Message Chains อ้างถึง Fowler ว่าเป็น Code Smell ชนิดหนึ่ง </li>
  <ul>
    Link : https://tusharma.in/smells/MC.html
  </ul>
<li> Code-Smells.com — Message Chain (Couplers) </li>
  <ul>
    Link : https://tusharma.in/smells/MC.html](https://code-smells.com/couplers/message-chains
  </ul>

  </ol>
---
